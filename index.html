// 1. Get the file URL from query parameter
const urlParams = new URLSearchParams(window.location.search);
const geojsonFileURL = urlParams.get('https://godrejinds-my.sharepoint.com/:x:/r/personal/aditya_vn_godrejproperties_com/Documents/dealdata.geojson'); 
// Example: 'https://godrejinds-my.sharepoint.com/:x:/r/personal/aditya_vn_godrejproperties_com/Documents/dealdata.geojson'

// 2. Initialize map
const map = L.map('map').setView([20.5937, 78.9629], 5); // Center on India

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
}).addTo(map);

// 3. Fetch geojson and plot pins
fetch(geojsonFileURL, { credentials: 'include' })
    .then(response => response.json())
    .then(data => {
        const geoLayer = L.geoJSON(data, {
            pointToLayer: function(feature, latlng) {
                let color = feature.properties.Status === "Active" ? "green" :
                            feature.properties.Status === "On Hold" ? "orange" :
                            "red";
                return L.circleMarker(latlng, { color: color, radius: 8 });
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup(
                    `<b>Lead:</b> ${feature.properties.LeadName}<br>
                     <b>Owner:</b> ${feature.properties.PrimaryOwner}<br>
                     <b>Status:</b> ${feature.properties.Status}<br>
                     <b>Stage:</b> ${feature.properties.Stage}<br>
                     <b>City:</b> ${feature.properties.City}<br>
                     <b>Site:</b> ${feature.properties.SiteLocation}`
                );
            }
        }).addTo(map);

        // Auto zoom to bounds
        map.fitBounds(geoLayer.getBounds());
    });
